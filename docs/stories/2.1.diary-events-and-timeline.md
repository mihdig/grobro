# Story 2.1: Diary Events and Timeline

## Status

Approved

## Story

**As a** grower tracking my plants in GroBro,  
**I want** to log key events (watering, feeding, notes, photos, stress) and see them in a timeline per plant,  
**so that** I can understand the full history of each grow and learn from it.

## Acceptance Criteria

1. For each plant, the user can create events of types at least:
   - Watering  
   - Feeding  
   - Flush  
   - Note  
   - Photo  
   - Stress (with stress tags)  
2. Each event persists in local storage and is linked to the correct plant.  
3. The Diary tab in Plant Detail shows a reverse chronological list of events for that plant.  
4. Events are visually differentiated by type (icons/labels) and show key metadata (timestamp, volume for watering/feeding, tags for stress, thumbnail for photos).  
5. The timeline can be filtered by event type (e.g., only watering, only stress).  
6. All diary functionality works offline and persists across app restarts.

## Tasks / Subtasks

- [x] Extend data model and services for events (AC: 1–2)
  - [x] Add `Event` entity to Core Data with fields from `data-model.md` (AC: 1–2)
  - [x] Implement `EventStore` in `Domain/Services/EventStore.swift` for creating and querying events (AC: 1–2)
  - [x] Ensure events reference `plantId` and are fetched by plant (AC: 2)
- [x] Implement Diary UI in Plant Detail (AC: 3–5)
  - [x] Add `DiaryTabView` and `DiaryViewModel` under `Features/Diary/` or `Features/PlantDetail/Tabs/` (AC: 3)
  - [x] Render reverse chronological list of events with type‑specific visuals and metadata (AC: 3–4)
  - [x] Add simple filter UI to show a subset of event types (AC: 5)
- [x] Implement event creation flows (AC: 1–2)
  - [x] Add entry points from Plant Detail (buttons/actions) to create each event type (AC: 1)
  - [x] On save, persist the event via `EventStore` and refresh the Diary (AC: 2)

## Dev Notes

- Follow `docs/architecture/data-model.md` for `Event` fields and `EventType`/`StressTag` enums.  
- Keep `EventStore` UI‑agnostic and unit testable.  
- For photos, store asset references (e.g., identifiers in the photo library or local URLs) rather than raw image blobs when possible, while staying within Core Data constraints.  
- Diary is per‑plant; cross‑plant views can be added in future stories.

### Testing

- Unit tests:
  - `EventStore` can create, fetch, and filter events by plant and type.  
  - DiaryViewModel correctly orders and groups events given mocked data.  
- Manual checks:
  - For a plant, create multiple events of different types; verify correct display and filtering in the Diary tab.  
  - Relaunch the app and confirm that all events are still visible.

## Change Log

| Date       | Version | Description                            | Author |
|-----------|---------|----------------------------------------|--------|
| 2025-11-14 | 0.1     | Initial story draft and approval       | PO/PM  |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

None

### Completion Notes List

- Implemented Event domain model with EventType and StressTag enums
- Created EventEntity in Core Data with all required fields
- Built EventStore service with create, fetch, filter, and delete operations
- Developed Diary tab view with reverse chronological timeline
- Implemented event filtering by type with interactive filter buttons
- Created event creation flow for all 6 event types
- Integrated Diary as tab in Plant Detail view
- All components follow MVVM architecture

### File List

- GroBroPackage/Sources/GroBroDomain/Models/Event.swift
- GroBroPackage/Sources/GroBroDomain/Models/EventType.swift
- GroBroPackage/Sources/GroBroDomain/Models/StressTag.swift
- GroBroPackage/Sources/GroBroDomain/Services/EventStore.swift
- GroBroPackage/Sources/GroBroPersistence/EventEntity+CoreDataClass.swift
- GroBroPackage/Sources/GroBroPersistence/EventEntity+CoreDataProperties.swift
- GroBroPackage/Sources/GroBroFeature/Diary/DiaryView.swift
- GroBroPackage/Sources/GroBroFeature/Diary/DiaryViewModel.swift
- GroBroPackage/Sources/GroBroFeature/Diary/EventCreationView.swift
- GroBroPackage/Sources/GroBroFeature/Diary/EventCreationViewModel.swift
- GroBroPackage/Sources/GroBroFeature/PlantDetail/PlantDetailView.swift (updated with tabs)
- GroBroPackage/Sources/GroBroFeature/PlantDetail/PlantDetailViewModel.swift (updated)
- GroBroPackage/Sources/GroBroPersistence/GroBroModel.xcdatamodeld/GroBroModel.xcdatamodel/contents (updated)

