# Story 16.5: PPM EC TDS Calculator and Tracker

## Status
Approved

## Story
**As a** grower using nutrients,
**I want** Convert between PPM/EC/TDS units, track readings over time,
**so that** I can feed my plants accurately and track nutrient data alongside environmental and diary events.

## Acceptance Criteria
1. PPM EC TDS Calculator and Tracker implemented with accurate calculations
2. Data integrates with plant diary timeline
3. Supports major nutrient brands (GHE, Advanced Nutrients, Fox Farm, Canna, BioBizz)
4. Safety warnings displayed prominently
5. Pro features gated appropriately
6. Educational tooltips explain nutrient concepts

## Tasks / Subtasks

- [ ] Implement PPM/EC/TDS conversion service (AC: 1)
  - [ ] Create `NutrientMeasurementConverter` utility class (AC: 1)
  - [ ] Implement EC to PPM (500 scale) conversion (AC: 1)
  - [ ] Implement EC to PPM (700 scale) conversion (AC: 1)
  - [ ] Implement PPM to EC conversion with scale detection (AC: 1)
  - [ ] Add unit tests for all conversion formulas (AC: 1)

- [ ] Create measurement tracking models (AC: 1, 2)
  - [ ] Create `NutrientMeasurement` model (value, unit, timestamp) (AC: 1)
  - [ ] Add `MeasurementUnit` enum (ppm500, ppm700, ec, tds) (AC: 1)
  - [ ] Extend NutrientEventData with measurement readings (AC: 2)
  - [ ] Add optional runoff measurements for comparison (AC: 1)

- [ ] Build PPM/EC/TDS calculator UI (AC: 1, 6)
  - [ ] Create `MeasurementConverterView` (AC: 1)
  - [ ] Add input field with unit picker (AC: 1)
  - [ ] Display real-time conversions to all units (AC: 1)
  - [ ] Show PPM 500 scale (US standard) (AC: 1)
  - [ ] Show PPM 700 scale (Truncheon) (AC: 1)
  - [ ] Show EC in mS/cm (AC: 1)
  - [ ] Add tooltips explaining scale differences (AC: 6)
  - [ ] Add "Save Reading" button to log measurement (AC: 2)

- [ ] Build measurement tracker (AC: 1, 2)
  - [ ] Create `MeasurementHistoryView` (AC: 1)
  - [ ] Display chart of PPM/EC over time (AC: 1)
  - [ ] Show feed vs runoff comparison (AC: 1)
  - [ ] Color-code readings by stage (veg/flower) (AC: 1)
  - [ ] Add target range indicators on chart (AC: 1)
  - [ ] Filter by plant and date range (AC: 1)

- [ ] Integrate with feeding events (AC: 2)
  - [ ] Add PPM/EC/TDS fields to feeding event creation (AC: 2)
  - [ ] Store measurements with Event in NutrientEventData (AC: 2)
  - [ ] Display measurements in timeline events (AC: 2)
  - [ ] Show measurement trends in plant detail analytics (AC: 2)

- [ ] Add safety warnings and recommendations (AC: 4, 6)
  - [ ] Display warning if PPM too high for stage (AC: 4)
  - [ ] Display warning if PPM too low for stage (AC: 4)
  - [ ] Show recommended ranges by growth stage (AC: 6)
  - [ ] Warn about large feed/runoff discrepancies (AC: 4)

- [ ] Apply Smart Greenhouse design (AC: 1)
  - [ ] Use GlassCard for converter and tracker (AC: 1)
  - [ ] Apply electric green accents to optimal ranges (AC: 1)
  - [ ] Use warning colors for out-of-range values (AC: 4)
  - [ ] Neon line charts for measurement history (AC: 1)

- [ ] Write tests (AC: 1-6)
  - [ ] Unit tests for all conversion formulas (AC: 1)
  - [ ] Unit tests for measurement tracking (AC: 1)
  - [ ] Test data storage in Event model (AC: 2)
  - [ ] Integration test for converter and tracker flow (AC: 1, 2)

## Dev Notes
- PPM/EC/TDS conversion formulas:
  - EC (mS/cm) × 500 = PPM (500 scale, US/Hanna standard)
  - EC (mS/cm) × 700 = PPM (700 scale, Truncheon/Eutech)
  - TDS meters measure PPM (TDS and PPM used interchangeably)
  - EC is the most accurate and universal measurement
- Recommended PPM ranges by stage:
  - Seedling: 100-250 PPM
  - Early Veg: 250-400 PPM
  - Late Veg: 400-800 PPM
  - Early Flower: 800-1000 PPM
  - Late Flower: 1000-1400 PPM
  - Flush: 0-200 PPM
- Runoff PPM should be within 100-200 PPM of feed PPM
- Store measurements in Event model with NutrientEventData
- Apply Smart Greenhouse design system
- Follow source tree: Utils in `GroBroDomain/Utils/`, Views in `GroBroFeature/Nutrients/`
- PPM/EC/TDS converter is FREE tier
- Advanced tracking analytics is FREE tier

## Change Log
| Date       | Version | Description | Author |
|-----------|---------|-------------|--------|
| 2025-11-15 | 1.0     | Initial story creation per user request | Mary (BA) |
| 2025-11-15 | 1.1     | Added detailed task breakdown | James (Dev) |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
(To be filled during implementation)

### Completion Notes List
(To be filled during implementation)

### File List
(To be filled during implementation)
