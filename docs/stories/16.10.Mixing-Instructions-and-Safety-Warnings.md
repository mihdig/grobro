# Story 16.10: Mixing Instructions and Safety Warnings

## Status
Approved

## Story
**As a** grower using nutrients,
**I want** Order of operations for mixing, safety warnings for concentrates and pH adjusters,
**so that** I can feed my plants accurately and track nutrient data alongside environmental and diary events.

## Acceptance Criteria
1. Mixing Instructions and Safety Warnings implemented with accurate calculations
2. Data integrates with plant diary timeline
3. Supports major nutrient brands (GHE, Advanced Nutrients, Fox Farm, Canna, BioBizz)
4. Safety warnings displayed prominently
5. Pro features gated appropriately
6. Educational tooltips explain nutrient concepts

## Tasks / Subtasks

- [ ] Create mixing instruction models (AC: 1, 3)
  - [ ] Create `MixingInstruction` model (step, product, order) (AC: 1)
  - [ ] Define mixing order rules by brand (AC: 3)
  - [ ] Create `SafetyWarning` model (type, severity, message) (AC: 4)
  - [ ] Define product-specific warnings (AC: 4)

- [ ] Implement mixing instruction service (AC: 1, 3)
  - [ ] Create `MixingInstructionService` (AC: 1)
  - [ ] Generate step-by-step mixing order (AC: 1)
  - [ ] Apply brand-specific mixing rules (AC: 3)
  - [ ] Detect incompatible product combinations (AC: 4)
  - [ ] Add unit tests for mixing logic (AC: 1)

- [ ] Define brand-specific mixing orders (AC: 1, 3)
  - [ ] GHE Flora/Bio mixing sequence (AC: 3)
    1. Fill reservoir with water
    2. Add Cal-Mag (if using RO water)
    3. Add base nutrients (Micro, Grow, Bloom)
    4. Add supplements
    5. Adjust pH last
  - [ ] Advanced Nutrients pH Perfect sequence (AC: 3)
  - [ ] Fox Farm Dirty Dozen sequence (AC: 3)
  - [ ] Canna Terra/Coco sequence (AC: 3)
  - [ ] BioBizz organic sequence (AC: 3)

- [ ] Build mixing instructions UI (AC: 1, 4, 6)
  - [ ] Create `MixingInstructionsView` (AC: 1)
  - [ ] Display step-by-step numbered instructions (AC: 1)
  - [ ] Show product-specific dosages per step (AC: 1)
  - [ ] Highlight current step during mixing (AC: 1)
  - [ ] Add checkboxes to track completion (AC: 1)
  - [ ] Display safety warnings at relevant steps (AC: 4)
  - [ ] Add tooltips explaining why order matters (AC: 6)

- [ ] Implement comprehensive safety warnings (AC: 4)
  - [ ] General nutrient safety warnings (AC: 4)
    - Concentrated nutrients can burn skin/eyes
    - Always add nutrients to water, never water to nutrients
    - Wear gloves when handling concentrates
    - Store away from children and pets
    - Mix in well-ventilated area
  - [ ] pH adjuster warnings (AC: 4)
    - pH Down (phosphoric/citric acid) is corrosive
    - pH Up (potassium hydroxide) is caustic
    - Add pH adjusters slowly (1-2ml at a time)
    - Wait 15-30 minutes between adjustments
    - Always retest pH before adding more
    - Can cause severe burns on contact
  - [ ] Product incompatibility warnings (AC: 4)
    - Warn about mixing calcium and sulfates (precipitation)
    - Warn about organic + synthetic interactions
    - Warn about exceeding recommended PPM

- [ ] Build safety warnings display system (AC: 4)
  - [ ] Create `SafetyWarningCard` component (AC: 4)
  - [ ] Use critical (red), caution (yellow), info (blue) levels (AC: 4)
  - [ ] Display warnings prominently with icons (AC: 4)
  - [ ] Show warnings in calculator before mixing (AC: 4)
  - [ ] Show warnings in feeding event creation (AC: 4)
  - [ ] Add "I Understand" acknowledgment for critical warnings (AC: 4)

- [ ] Build pH adjustment safety flow (AC: 4, 6)
  - [ ] Create `PHAdjustmentSafetyView` (AC: 4)
  - [ ] Display pH adjuster safety warnings (AC: 4)
  - [ ] Show step-by-step safe adjustment process (AC: 6)
  - [ ] Recommend small adjustments with retesting (AC: 6)
  - [ ] Warn against over-adjusting (pH bounce) (AC: 4)

- [ ] Integrate mixing instructions with calculator (AC: 1, 2)
  - [ ] Generate mixing instructions from calculator (AC: 1)
  - [ ] Display instructions after dosage calculation (AC: 1)
  - [ ] Allow printing/sharing mixing instructions (AC: 1)
  - [ ] Save mixing order with feeding event (AC: 2)

- [ ] Apply Smart Greenhouse design (AC: 1, 4)
  - [ ] Use GlassCard for instruction steps (AC: 1)
  - [ ] Apply red neon glow for critical warnings (AC: 4)
  - [ ] Use yellow accents for caution warnings (AC: 4)
  - [ ] Electric green checkmarks for completed steps (AC: 1)
  - [ ] Consistent glassmorphic styling (AC: 1)

- [ ] Write tests (AC: 1-6)
  - [ ] Unit tests for mixing order generation (AC: 1)
  - [ ] Unit tests for incompatibility detection (AC: 4)
  - [ ] Unit tests for safety warning triggers (AC: 4)
  - [ ] Integration test for mixing instructions flow (AC: 1, 4)

## Dev Notes
- Proper mixing order prevents:
  - Nutrient precipitation (calcium + sulfate)
  - Nutrient lockout
  - pH swings
  - Product incompatibility
- General mixing order:
  1. Start with clean reservoir and correct water temperature (65-75°F)
  2. Fill reservoir to desired level
  3. Add Cal-Mag first (if using RO water)
  4. Add base nutrients in order (usually Micro → Grow → Bloom)
  5. Add supplements (silica first if using)
  6. Stir/circulate thoroughly
  7. Let solution stabilize 15-30 minutes
  8. Measure PPM/EC
  9. Adjust pH last (nutrients affect pH)
  10. Retest pH after 30 minutes
- pH adjusters are the most dangerous products (corrosive/caustic)
- Apply Smart Greenhouse design system
- Follow source tree: Services in `GroBroDomain/Services/`, Views in `GroBroFeature/Nutrients/`
- Mixing instructions are FREE tier
- Safety warnings are critical for user safety and app liability

## Change Log
| Date       | Version | Description | Author |
|-----------|---------|-------------|--------|
| 2025-11-15 | 1.0     | Initial story creation per user request | Mary (BA) |
| 2025-11-15 | 1.1     | Added detailed task breakdown | James (Dev) |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
(To be filled during implementation)

### Completion Notes List
(To be filled during implementation)

### File List
(To be filled during implementation)
