# Story 16.6: pH Tracking and Recommendations

## Status
Approved

## Story
**As a** grower using nutrients,
**I want** Track pH, show target ranges, recommend adjustments,
**so that** I can feed my plants accurately and track nutrient data alongside environmental and diary events.

## Acceptance Criteria
1. pH Tracking and Recommendations implemented with accurate calculations
2. Data integrates with plant diary timeline
3. Supports major nutrient brands (GHE, Advanced Nutrients, Fox Farm, Canna, BioBizz)
4. Safety warnings displayed prominently
5. Pro features gated appropriately
6. Educational tooltips explain nutrient concepts

## Tasks / Subtasks

- [ ] Create pH tracking models (AC: 1, 2)
  - [ ] Create `PHMeasurement` model (value, timestamp, type) (AC: 1)
  - [ ] Add `PHMeasurementType` enum (feed, runoff, reservoir) (AC: 1)
  - [ ] Extend NutrientEventData with pH readings (AC: 2)
  - [ ] Create `PHAdjustment` model (amount, direction, product) (AC: 1)

- [ ] Implement pH recommendation service (AC: 1, 6)
  - [ ] Create `PHRecommendationService` (AC: 1)
  - [ ] Define optimal pH ranges by grow medium (AC: 1, 6)
  - [ ] Calculate adjustment needed (up/down, amount) (AC: 1)
  - [ ] Recommend specific pH adjuster products (AC: 1)
  - [ ] Add unit tests for pH calculations (AC: 1)

- [ ] Build pH tracker UI (AC: 1, 4, 6)
  - [ ] Create `PHTrackerView` (AC: 1)
  - [ ] Add pH input field with decimal precision (AC: 1)
  - [ ] Add measurement type selector (feed/runoff/reservoir) (AC: 1)
  - [ ] Display current pH value prominently (AC: 1)
  - [ ] Show target range indicator (AC: 1, 6)
  - [ ] Color-code pH (green = optimal, yellow = adjust, red = critical) (AC: 4)
  - [ ] Add tooltips explaining pH importance (AC: 6)
  - [ ] Show "Log pH" button to save measurement (AC: 2)

- [ ] Build pH adjustment calculator (AC: 1, 4, 6)
  - [ ] Create `PHAdjustmentCalculatorView` (AC: 1)
  - [ ] Input current pH and target pH (AC: 1)
  - [ ] Input reservoir volume (AC: 1)
  - [ ] Calculate ml of pH up/down needed (AC: 1)
  - [ ] Display step-by-step adjustment instructions (AC: 6)
  - [ ] Show safety warnings for pH adjusters (AC: 4)
  - [ ] Warn about adding slowly and retesting (AC: 4)

- [ ] Build pH history and trends (AC: 1, 2)
  - [ ] Create `PHHistoryView` with line chart (AC: 1)
  - [ ] Display pH over time (feed vs runoff) (AC: 1)
  - [ ] Show target range band on chart (AC: 1)
  - [ ] Color-code readings by grow medium (AC: 1)
  - [ ] Filter by plant and date range (AC: 1, 2)
  - [ ] Identify pH drift patterns (AC: 1)

- [ ] Integrate with feeding events (AC: 2)
  - [ ] Add pH fields to feeding event creation (AC: 2)
  - [ ] Store pH data in Event with NutrientEventData (AC: 2)
  - [ ] Display pH in timeline events (AC: 2)
  - [ ] Show pH trends in plant detail analytics (AC: 2)

- [ ] Add pH recommendations and warnings (AC: 4, 6)
  - [ ] Show optimal pH range by grow medium (AC: 6)
    - Soil: 6.0-7.0
    - Coco: 5.8-6.2
    - Hydro: 5.5-6.0
  - [ ] Warn if pH out of optimal range (AC: 4)
  - [ ] Warn if pH > 7.5 or pH < 5.0 (critical) (AC: 4)
  - [ ] Explain pH lockout risks (AC: 6)
  - [ ] Recommend pH Perfect nutrients for beginners (AC: 6)

- [ ] Apply Smart Greenhouse design (AC: 1)
  - [ ] Use GlassCard for pH tracker (AC: 1)
  - [ ] Apply electric green for optimal pH (AC: 1)
  - [ ] Use warning colors (yellow/red) for off-range (AC: 4)
  - [ ] Neon line charts for pH history (AC: 1)

- [ ] Write tests (AC: 1-6)
  - [ ] Unit tests for pH recommendation service (AC: 1)
  - [ ] Unit tests for adjustment calculations (AC: 1)
  - [ ] Test data storage in Event model (AC: 2)
  - [ ] Integration test for pH tracking flow (AC: 1, 2)

## Dev Notes
- Optimal pH ranges by grow medium:
  - Soil: 6.0-7.0 (slightly acidic to neutral)
  - Soilless/Coco: 5.8-6.2 (slightly acidic)
  - Hydroponic: 5.5-6.0 (acidic)
- pH affects nutrient availability (pH lockout occurs outside optimal range)
- pH naturally drifts as plants consume nutrients
- Advanced Nutrients "pH Perfect" technology auto-balances pH (5.5-6.3)
- Store pH data in Event model with NutrientEventData
- Apply Smart Greenhouse design system
- Follow source tree: Services in `GroBroDomain/Services/`, Views in `GroBroFeature/Nutrients/`
- pH tracking is FREE tier
- pH adjustment calculator is FREE tier

## Change Log
| Date       | Version | Description | Author |
|-----------|---------|-------------|--------|
| 2025-11-15 | 1.0     | Initial story creation per user request | Mary (BA) |
| 2025-11-15 | 1.1     | Added detailed task breakdown | James (Dev) |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
(To be filled during implementation)

### Completion Notes List
(To be filled during implementation)

### File List
(To be filled during implementation)
