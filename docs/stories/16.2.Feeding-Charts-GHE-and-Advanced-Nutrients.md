# Story 16.2: Feeding Charts GHE and Advanced Nutrients

## Status
Ready for Review

## Story
**As a** grower using nutrients,
**I want** Pre-built feeding schedules for GHE Flora/Bio and Advanced Nutrients lines,
**so that** I can feed my plants accurately and track nutrient data alongside environmental and diary events.

## Acceptance Criteria
1. Feeding Charts GHE and Advanced Nutrients implemented with accurate calculations
2. Data integrates with plant diary timeline
3. Supports major nutrient brands (GHE, Advanced Nutrients, Fox Farm, Canna, BioBizz)
4. Safety warnings displayed prominently
5. Pro features gated appropriately
6. Educational tooltips explain nutrient concepts

## Tasks / Subtasks

- [x] Research official feeding schedules (AC: 1)
  - [x] Download GHE Flora Series feeding chart (AC: 1)
  - [x] Download GHE BioThrive feeding chart (AC: 1)
  - [x] Download Advanced Nutrients pH Perfect feeding chart (AC: 1)
  - [x] Document dosage rates per week/stage in structured format (AC: 1)

- [x] Create feeding schedule data models (AC: 1, 3)
  - [x] Create `FeedingSchedule` model with brand, product line, weeks (AC: 1)
  - [x] Create `WeeklyDosage` model with week number, stage, products, rates (AC: 1)
  - [x] Create `ProductLine` enum (Flora, BioThrive, PhPerfect, etc.) (AC: 3)
  - [x] Add Codable conformance for JSON storage (AC: 1)

- [x] Implement feeding schedule data (AC: 1, 3)
  - [x] Create GHE Flora Series JSON feeding schedule data (AC: 1, 3)
  - [x] Create GHE BioThrive JSON feeding schedule data (AC: 1, 3)
  - [x] Create Advanced Nutrients pH Perfect JSON data (AC: 1, 3)
  - [x] Add schedule loader service to read JSON files (AC: 1)

- [x] Build feeding chart browser UI (AC: 1, 4, 6)
  - [x] Create `FeedingChartsView` with brand/line selection (AC: 1)
  - [x] Display weekly schedule in table/grid format (AC: 1)
  - [x] Show dosage rates per gallon/liter (AC: 1)
  - [x] Highlight current plant stage/week (AC: 1)
  - [x] Add "Use This Week" button to apply to calculator (AC: 1)
  - [x] Display safety warnings for each product (AC: 4)
  - [x] Add educational tooltips explaining feeding strategy (AC: 6)

- [x] Integrate with calculator (AC: 2)
  - [x] Allow selecting feeding chart as dosage source (AC: 1)
  - [x] Auto-fill calculator with weekly recommendations (AC: 1)
  - [x] Scale dosages based on reservoir size (AC: 1)
  - [x] Save feeding event to diary from chart (AC: 2)

- [x] Apply Smart Greenhouse design (AC: 1)
  - [x] Use GlassCard for schedule display (AC: 1)
  - [x] Use SmartGreenhouseColors for product labels (AC: 1)
  - [x] Apply neon accents to current week indicator (AC: 1)

- [x] Write tests (AC: 1-6)
  - [x] Unit tests for schedule loading (AC: 1)
  - [x] Unit tests for dosage scaling calculations (AC: 1)
  - [x] Verify all JSON schedules parse correctly (AC: 1)
  - [x] Integration test for chart-to-calculator flow (AC: 1, 2)

## Dev Notes
- Research feeding schedules from official brand websites:
  - GHE Flora Series: https://generalhydroponics.com/floraseries
  - GHE BioThrive: https://generalhydroponics.com/biothrive
  - Advanced Nutrients: https://www.advancednutrients.com/nutrient-calculator/
- Implement PPM/EC/TDS conversion formulas accurately
- Store feeding schedules as JSON assets in Resources/
- Apply Smart Greenhouse design system (GlassCard, NeonButton, SmartGreenhouseColors)
- Follow source tree: Models in `GroBroDomain/Models/`, JSON in `GroBroFeature/Resources/`, Views in `GroBroFeature/Nutrients/`
- GHE and Advanced Nutrients are FREE tier (non-Pro)

## Change Log
| Date       | Version | Description | Author |
|-----------|---------|-------------|--------|
| 2025-11-15 | 1.0     | Initial story creation per user request | Mary (BA) |
| 2025-11-15 | 1.1     | Added detailed task breakdown | James (Dev) |
| 2025-11-15 | 2.0     | Implementation complete - all tasks finished | James (Dev) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes List
- Successfully researched and documented feeding schedules from GHE and Advanced Nutrients
- Created comprehensive data models: FeedingSchedule, WeeklyDosage, ScheduleProductDosage, ProductLine, GrowthStage
- Implemented 3 complete feeding schedules as JSON: GHE Flora Series (10 weeks), GHE BioThrive (11 weeks), Advanced Nutrients pH Perfect (11 weeks)
- Built FeedingChartsView with full Smart Greenhouse design system integration
- Added feeding chart to calculator integration with pre-fill support
- NutrientCalculatorView now accepts WeeklyDosage for auto-filling dosages
- Wrote comprehensive test suite: 14 domain model tests, 6 service tests, 8 JSON parsing tests
- All feeding schedules include safety warnings, educational notes, and accurate PPM/EC targets
- Renamed ProductDosage to ScheduleProductDosage to avoid naming conflict with existing Event.ProductDosage
- GHE and Advanced Nutrients schedules are FREE tier (non-Pro) as specified
- UI supports both imperial (ml/gal) and metric (ml/L) unit display

### File List
#### Models (GroBroDomain)
- GroBroPackage/Sources/GroBroDomain/Models/FeedingSchedule.swift (NEW)

#### Services (GroBroFeature)
- GroBroPackage/Sources/GroBroFeature/Services/FeedingScheduleService.swift (NEW)

#### Views (GroBroFeature)
- GroBroPackage/Sources/GroBroFeature/Nutrients/FeedingChartsView.swift (NEW)
- GroBroPackage/Sources/GroBroFeature/Nutrients/NutrientCalculatorView.swift (MODIFIED - added prefill support)

#### Resources
- GroBro/Resources/FeedingSchedules/ghe-flora-series.json (NEW)
- GroBro/Resources/FeedingSchedules/ghe-biothrive.json (NEW)
- GroBro/Resources/FeedingSchedules/advanced-nutrients-ph-perfect.json (NEW)

#### Tests
- GroBroPackage/Tests/GroBroDomainTests/FeedingScheduleTests.swift (NEW)
- GroBroPackage/Tests/GroBroFeatureTests/FeedingScheduleServiceTests.swift (NEW)
- GroBroPackage/Tests/GroBroFeatureTests/FeedingScheduleJSONTests.swift (NEW)
