# Story 16.7: Nutrient Event Logging and Timeline

## Status
Approved

## Story
**As a** grower using nutrients,
**I want** Log feeding events with brand, product, dosage, PPM, pH to timeline,
**so that** I can feed my plants accurately and track nutrient data alongside environmental and diary events.

## Acceptance Criteria
1. Nutrient Event Logging and Timeline implemented with accurate calculations
2. Data integrates with plant diary timeline
3. Supports major nutrient brands (GHE, Advanced Nutrients, Fox Farm, Canna, BioBizz)
4. Safety warnings displayed prominently
5. Pro features gated appropriately
6. Educational tooltips explain nutrient concepts

## Tasks / Subtasks

- [ ] Finalize NutrientEventData model (AC: 1, 2)
  - [ ] Create complete `NutrientEventData` struct (AC: 1)
  - [ ] Add brand and product line fields (AC: 3)
  - [ ] Add list of products with dosages (AC: 1)
  - [ ] Add PPM/EC readings (feed and runoff) (AC: 1)
  - [ ] Add pH readings (feed and runoff) (AC: 1)
  - [ ] Add reservoir volume (AC: 1)
  - [ ] Add optional recipe reference (AC: 1)
  - [ ] Add Codable conformance (AC: 2)

- [ ] Update Event model integration (AC: 2)
  - [ ] Add nutrientData optional field to Event (AC: 2)
  - [ ] Update EventEntity Core Data with nutrient fields (AC: 2)
  - [ ] Implement encoding/decoding for persistence (AC: 2)
  - [ ] Update EventStore to save/load nutrient data (AC: 2)

- [ ] Build feeding event creation flow (AC: 1, 2, 3)
  - [ ] Create `FeedingEventEditorView` (AC: 1, 2)
  - [ ] Add brand/product line selection (AC: 3)
  - [ ] Add product dosage inputs (AC: 1)
  - [ ] Add PPM/EC input fields (AC: 1)
  - [ ] Add pH input fields (AC: 1)
  - [ ] Add reservoir volume input (AC: 1)
  - [ ] Add optional notes field (AC: 1)
  - [ ] Add "Save Feeding" button (AC: 2)
  - [ ] Validate required fields before saving (AC: 1)

- [ ] Build feeding event display in timeline (AC: 2)
  - [ ] Update DiaryView to display feeding events (AC: 2)
  - [ ] Create `FeedingEventRowView` component (AC: 2)
  - [ ] Display brand logo/icon (AC: 3)
  - [ ] Show product list with dosages (AC: 1)
  - [ ] Display PPM and pH prominently (AC: 1)
  - [ ] Show reservoir volume (AC: 1)
  - [ ] Add "Use Again" quick action button (AC: 2)
  - [ ] Apply Smart Greenhouse card styling (AC: 2)

- [ ] Build detailed feeding event view (AC: 1, 2)
  - [ ] Create `FeedingEventDetailView` (AC: 2)
  - [ ] Display full nutrient mix details (AC: 1)
  - [ ] Show calculated vs measured PPM comparison (AC: 1)
  - [ ] Display feed vs runoff pH comparison (AC: 1)
  - [ ] Show mixing order if available (AC: 1)
  - [ ] Add edit and delete options (AC: 2)

- [ ] Implement timeline filtering (AC: 2)
  - [ ] Add "Show Feeding Only" filter toggle (AC: 2)
  - [ ] Filter by brand (AC: 3)
  - [ ] Filter by date range (AC: 2)
  - [ ] Sort by most recent first (AC: 2)

- [ ] Apply Smart Greenhouse design (AC: 1, 2)
  - [ ] Use GlassCard for feeding event cards (AC: 2)
  - [ ] Apply brand-specific color accents (AC: 3)
  - [ ] Use electric green for optimal PPM/pH (AC: 1)
  - [ ] Use warning colors for out-of-range values (AC: 4)
  - [ ] Consistent glassmorphic styling (AC: 1)

- [ ] Write tests (AC: 1-6)
  - [ ] Unit tests for NutrientEventData encoding/decoding (AC: 2)
  - [ ] Unit tests for Event with nutrient data persistence (AC: 2)
  - [ ] Integration test for feeding event creation (AC: 1, 2)
  - [ ] Integration test for timeline display (AC: 2)

## Dev Notes
- NutrientEventData should be a comprehensive struct containing:
  - Brand and product line
  - List of products with dosages
  - PPM/EC readings (feed and optionally runoff)
  - pH readings (feed and optionally runoff)
  - Reservoir volume
  - Optional recipe reference for reuse
- Store as JSON in EventEntity for Core Data persistence
- Timeline should show feeding events alongside watering, photos, notes, etc.
- Apply Smart Greenhouse design system
- Follow source tree: Models in `GroBroDomain/Models/`, Views in `GroBroFeature/Diary/`
- Feeding event logging is FREE tier
- All brands available based on user's subscription tier

## Change Log
| Date       | Version | Description | Author |
|-----------|---------|-------------|--------|
| 2025-11-15 | 1.0     | Initial story creation per user request | Mary (BA) |
| 2025-11-15 | 1.1     | Added detailed task breakdown | James (Dev) |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
(To be filled during implementation)

### Completion Notes List
(To be filled during implementation)

### File List
(To be filled during implementation)
